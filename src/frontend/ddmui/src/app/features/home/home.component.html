<app-navbar></app-navbar>
<div class="p-4">
  <p-card>
    <p-tabs [(value)]="activeTab">
      <p-tablist>
        <p-tab [value]="0">Simple Search</p-tab>
        <p-tab [value]="1">Boolean Search</p-tab>
        <p-tab [value]="2">GeoLocation Search</p-tab>
        <p-tab [value]="3">KNN Search</p-tab>
      </p-tablist>

      <p-tabpanels>
        <p-tabpanel [value]="0">
          <div class="flex gap-2 align-items-center">
            <!-- Field Dropdown -->
            <p-dropdown
              [options]="searchFields"
              [(ngModel)]="selectedField"
              optionLabel="label"
              optionValue="value"
              placeholder="Select Field"
              styleClass="w-14rem"
            >
            </p-dropdown>

            <!-- Search Input -->
            <input
              pInputText
              [(ngModel)]="searchQuery"
              placeholder="Enter search value..."
              class="w-20rem"
            />

            <!-- Search Button -->
            <button
              pButton
              label="Search"
              icon="pi pi-search"
              (click)="search()"
            ></button>
          </div>
        </p-tabpanel>

        <p-tabpanel [value]="1">
          <div class="flex flex-column gap-2">
            <!-- Boolean Query Input -->
            <textarea
              pInputTextarea
              rows="3"
              [(ngModel)]="booleanQuery"
              placeholder="Enter boolean search..."
              class="w-full"
            >
            </textarea>

            <!-- Search Button -->
            <button
              pButton
              label="Search"
              icon="pi pi-search"
              (click)="search()"
              [disabled]="!booleanQuery.trim()"
            ></button>
          </div>
        </p-tabpanel>

        <p-tabpanel [value]="2">
          <div class="flex flex-column gap-2">
            <!-- Address Input -->
            <input
              pInputText
              [(ngModel)]="geoAddress"
              placeholder="Enter address..."
              class="w-30rem"
            />

            <!-- Radius Input -->
            <input
              pInputText
              type="number"
              [(ngModel)]="geoRadius"
              placeholder="Radius (km)"
              class="w-10rem"
            />

            <!-- Search Button -->
            <button
              pButton
              label="Search"
              icon="pi pi-search"
              (click)="search()"
              [disabled]="!geoAddress || !geoRadius"
            ></button>
          </div>
        </p-tabpanel>

        <p-tabpanel [value]="3">
          <p-tabpanel [value]="3">
            <div class="flex gap-2 align-items-center">
              <!-- KNN Query Input -->
              <input
                pInputText
                [(ngModel)]="knnQuery"
                placeholder="Enter your KNN query..."
                class="w-20rem"
              />

              <!-- Search Button -->
              <button
                pButton
                label="Search"
                icon="pi pi-search"
                (click)="search()"
                [disabled]="!knnQuery"
              ></button>
            </div>
          </p-tabpanel>
        </p-tabpanel>
      </p-tabpanels>
    </p-tabs>
  </p-card>

  <!-- Results Table -->
  <p-card class="mt-4">
    <p-table
      [value]="results"
      [paginator]="true"
      [rows]="rows"
      [totalRecords]="totalRecords"
      [first]="0"
      (onPage)="onPageChange($event)"
      [selectionMode]="'single'"
      [dataKey]="'id'"
    >
      <!-- Header -->
      <ng-template pTemplate="header">
        <tr>
          @for (col of columns; track col.field) {
            <th>{{ col.header }}</th>
          }
        </tr>
      </ng-template>

      <!-- Body -->
      <ng-template pTemplate="body" let-row>
        <tr [pSelectableRow]="'row'">
          @for (col of columns; track col.field) {
            <td>{{ row[col.field] }}</td>
          }
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-row>
        <tr (click)="downloadRowFile(row)">
          @for (col of columns; track col.field) {
            <!-- Use innerHTML for summary / highlighted fields -->
            <td
              class="highlight"
              [innerHTML]="
                row[col.field] || row[col.field.replace('Summary', '')]
              "
            >
            </td>
          }
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>
